<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/><link rel="stylesheet" href="/styles.css"/><title>brurberg.dev</title><meta name="twitter:title" content="brurberg.dev"/><meta name="og:title" content="brurberg.dev"/></head><body class="sans-serif"><div><div><div class="tc pv4 pv5-ns"><a href="/"><img src="https://avatars3.githubusercontent.com/u/12571304?s=460&v=4" class="br-100 pa1 ba b--black-10 h3 w3" alt="Avatar"/></a><a href="/" class="no-underline"><h1 class="f5 f4-ns fw6 mid-gray">brurberg.dev</h1></a><h2 class="f6 gray fw2 ttu tracked">Just another remote app developer</h2><div class="tc pa3"><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/about">About</a><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/articles">Articles</a><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/projects">Projects</a></div></div></div><div class="sans-serif tc"><div class="flex justify-center"><div class="ph2 mw6-ns w-100 flex-none"><p class="f5 fw4 gray mt0">19.06.2019</p><div class="post-tags"><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-light-blue">react-native</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-orange">swift</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-gray">javascript</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-green">android</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-blue">ios</a></div><div><div class="tl"><h1>SwiftUI and Swift Package Manager: Combine!</h1><p>So, now it's been almost two weeks since WWDC, and we are currently on the second iteration on betas. Today I got the opportunity to experiment with a lot of stuff I don't know too much about: SwiftUI, Combine, Swift Package Manager and Swift. I have played around with Swift before, but I donâ€™t use it often enough to feel comfortable with it. So I figured I should try it allâ€¦ My feelings going in: â€œI have no idea what Iâ€™m doingâ€</p><img src="https://cdn-images-1.medium.com/max/2008/1*7N_pMAomi-v06ZW4-NAqNA.jpeg" alt="My feelings going into this"/><p>So what am I doing? So, as Iâ€™ve mentioned in an earlier post: Iâ€™ve made created a package with Dart and Flutter that provides core functionality and business logic specific for my company. Making app development easier since you don't have to write models, fetch, authentication and the like again and again for each app. One small part of this package is the hookups to our central language system. So I wanted to recreate this language part with Swift, and make it available to other internal developers as a Swift PackageğŸ“¦ I also wanted to prove to my self that Dart and Flutter skills do indeed transfer somewhat over to SwiftUI skills.</p><p>So where to begin. I needed to install the macOS Catalina beta (<a href="https://medium.com/@martinlasek/install-macos-catalina-xcode-11-beta-4701b6e3a296">I did it following this guide</a>) then Xcode 11 beta. When I finished this process I was ready. I created a new project â€œFile -&gt; New -&gt; Swift Packageâ€ Swift Package is new to Xcode 11, and Apple have integrated Swift Package Manager into Xcode. This gives you a package project to work with with tests. Then I had to write my structs for handling the JSON data from my API, and then a simple parser function:</p><script src="https://gist.github.com/brorhb/ca4d36f40c2c443d502495af63f2eb87.js"></script><p>Pretty cool ğŸ˜ Or, it's cool to meâ€¦ If you know Swift this is probably not impressive. Now you can parse JSON into a struct as long itâ€™s a one to one with the struct.</p><p>let myListOfItems: [Item] = parser(json)</p><p>Now I needed to figure out what to do with this data. I needed to make it available to other classes, and somehow notify other classes when this class gets some data.</p><p>import Combine import SwiftUI</p><p>Pretty much the answer. I needed to make my class conform to BindableObject and have some variable to notify listeners when the class is ready. I donâ€™t know if Iâ€™ve done this the right way, but it works.</p><script src="https://gist.github.com/brorhb/dff0cd2d35736a6a7338bca5bef2d750.js"></script><p>This is pretty much what happens. There is more going on, but that is specific for my use-case and donâ€™t serve to much a purpose here ğŸ˜…</p><p>Now after writing this, I was ready to test it within a separate SwiftUI project. I created my SwiftUI project, and added the package. I struggled way to much with this step, and I could not find much information about this either.</p><p>So this is how I did it. Itâ€™s pretty simple, but I did not know how to it</p><ol><li>Drag the folder of the package into the project (It should be at the same level as the ContentView.swift file in a new SwiftUI project)</li></ol><ol start="2"><li>Open the settings pane where you set display name, Bundle Identifier, Deployment info and the like. Scroll down to â€œFrameworks, Libraries and Embedded Contentâ€. Click the plus button</li></ol><ol start="3"><li>At the top of the list that is now reviled you can hopefully see you package, maybe you need to scroll, I did not need to but YMMV.</li></ol><ol start="4"><li>Click little library icon looking kind of like this: ğŸ›</li></ol><ol start="5"><li>Click Add</li></ol><p>Now you can import the classes of you package ğŸ˜</p><p>At this point I discovered that Xcode did not see my classes. I quickly learned that anything you want to expose to you app, needs to be public. I don't know if this is the right way to do it, but it worksâ€¦ Will update if I learn something new on this.</p><p>So I needed to update my package</p><script src="https://gist.github.com/brorhb/32285a3b84147f5a4c8467988f74f927.js" charset="utf-8"></script><p>Note that I also needed to make the Phrase struct public.</p><p>Now I you can use the package like this!</p><script src="https://gist.github.com/brorhb/498f97e3dfe5d9fda03dae081154aa41.js" charset="utf-8"></script><p>Now stuff works! And what a joy ğŸ™Œ</p><p>Butâ€¦ I got an error, or not an error but a purple looking warning âš ï¸ Telling me something about not triggering UI updates on a background thread. This is easy to fix. Although Iâ€™m not yet sure this is the best way to handle this:</p><p>In the package, change this:</p><p>public var state: LoadingState = .loading { didSet { didChange.send(self) } }</p><p>into this:</p><p>public var state: LoadingState = .loading { didSet { DispatchQueue.main.async { self.didChange.send(self) } } }</p><p>Now it works!</p><p>And I at least have learned a lot! And what a wonderful feeling to get this to work ğŸ˜ The hardest part were that there is basically no tutorials on this yet, so I had to learn from the documentation, experimentation and trying to understand the errors Xcode threw at me. But Iâ€™m happy with the outcome.</p><p>I have since implemented a getPhrase method that returns a single phrase as a string based on some id. Iâ€™m super happy with todays work, and I want to do more SwiftUI development in the future ğŸ˜</p></div></div></div></div></div></div></body></html>