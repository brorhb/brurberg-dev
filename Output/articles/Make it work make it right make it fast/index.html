<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/><link rel="stylesheet" href="/styles.css"/><title>brurberg.dev</title><meta name="twitter:title" content="brurberg.dev"/><meta name="og:title" content="brurberg.dev"/></head><body class="sans-serif"><div><div><div class="tc pv4 pv5-ns"><a href="/"><img src="https://avatars3.githubusercontent.com/u/12571304?s=460&v=4" class="br-100 pa1 ba b--black-10 h3 w3" alt="Avatar"/></a><a href="/" class="no-underline"><h1 class="f5 f4-ns fw6 mid-gray">brurberg.dev</h1></a><h2 class="f6 gray fw2 ttu tracked">Just another remote app developer</h2><div class="tc pa3"><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/about">About</a><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/articles">Articles</a><a class="f6 fw4 hover-black no-underline black-60 dn dib-ns pv2 ph3" href="/projects">Projects</a></div></div></div><div class="sans-serif tc"><div class="flex justify-center"><div class="ph2 mw6-ns w-100 flex-none"><p class="f5 fw4 gray mt0">22.11.2019</p><div class="post-tags"><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-pink">flutter</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-gray">javascript</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-light-blue">react-native</a><a class="mr1 f6 grow no-underline br-pill ph2 pv1 mb1 dib white bg-orange">swift</a></div><div><div class="tl"><h1>“Make it work, make it right, make it fast”</h1><p>The title, is a phrase my mentor told me. And to be honest at the time, I did not think to much about it. I was like: “Yeah, that makes sense… (I guess💭)”. But the other day I started to think more about it, and realised how it had manifested it self during the last couple of months.</p><p>As stated in this <a href="https://medium.com/@brorbrurberg/ecoonline-mobile-apps-2-0-7b0b8d9055d9">post</a>, I recreated a rather big app in Flutter and released it to our customers. At that point, it worked🎉! And that was the goal of it, It should work for our customers, and provide a nice experience. But I was kind of pressed on time (pressure mostly applied by me😅), and the focus were to only make it work.</p><p>After the initial release, I have dedicated myself to release an update every 2 weeks. Be it new features or just fixes and performance updates. So, since I can’t always spit out new features, I get time to fix issues, tweak code, be all nitty gritty 😁</p><p>I quickly realized; In my rush to release, I did not care to much about using compute methods, that is available in Flutter. With the compute function, you can move a task to a new <a href="https://api.flutter.dev/flutter/dart-isolate/Isolate-class.html">Isolate</a>. To shortly explain what happens when you do that: You move a task to a separate thread, with its own memory. By doing this, you can move heavy calculations away from your main thread. This is important beacuse, <a href="https://www.youtube.com/watch?v=vl_AaCgudcY&feature=emb_logo@">Dart is a single-threaded language</a> and if you clog up the main thread, you will freeze the UI, and the user will notice that thinking you app is slow.</p><p>So I started to time a lot of methods, to figure out if something should be done on a seperate thread.</p><script src="https://gist.github.com/brorhb/74c876d39be0b8c90de33863ea0c866b.js" charset="utf-8"></script><p>And like most of you know, the goal with Flutter is to keep a high refresh rate. And try to keep it above 60FPS. That means you have (1000ms / 60frames) around 16,666666667ms/frame. So if your calculation takes more than 16ms you run the risk of stutters in you app, since this happens in the same place as where you run your UI code.</p><p>This is the making it right part. I think by moving heavy manipulations of lists and other costly calculations into compute methods, making the life of the main thread easier.</p><p>This is a good talk about why that is a good thing 😁 The talk focuses on the web, but I found it really useful non the less.</p><iframe width="560" height="315" src="https://www.youtube.com/embed/7Rrv9qFMWNM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>And now… Making it fast. I can’t give you a whole lot of tips here, since a lot comes down to know the tool you are using, in my case: Dart.</p><p>But I do have some tricks that helped me a lot! Like any application, my apps use lists of data. And like you need to do in a lot of lists, you need to look up that information.</p><script src="https://gist.github.com/brorhb/bbc0e66e7ee99eeaec1576e203fc3014.js" charset="utf-8"></script><p>The example shows how I switched from using list of item, to a map with key/value pair of item.id as key, and the item as the value. In some cases this can yield huge performance gains. But, like I said: A lot comes down to knowing your tool. In Dart, you should make yourself very familiar with all the methods you can run on a Iterable. Methods like: map, fold and reduce can help you a lot 😁</p></div></div></div></div></div></div><footer class="pv4 ph3 ph5-m ph6-l mid-gray"><div class="f6 db tc">© 2020 Bror Brurberg All Rights Reserved</div><div class="pv4 ph3 ph5-m ph6-l mid-gray f6 db tc">Generated using <a href="https://github.com/johnsundell/publish">Publish</a>. Written in Swift</div></footer></body></html>